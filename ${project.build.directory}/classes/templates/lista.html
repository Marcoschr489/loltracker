<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Campeões Salvos</title>
  <link rel="stylesheet" th:href="@{/style.css}" />
</head>
<body>
<h1>Campeões Salvos</h1>

<a href="/campeoes/novo">
  <button type="button" class=" botao_dex ">Novo Campeão</button>
</a>
<div class="campeoes-grid">
  <div th:each="campeao : ${campeoes}" class="campeao-card">
    <div class="nome" th:text="${campeao.nome}">Nome do Campeão</div>

    <div class="detalhes">
      <span><strong>Função:</strong> <span th:text="${campeao.role}">Função</span></span><br>
      <span><strong>Lane:</strong> <span th:text="${campeao.lane}">Lane</span></span><br>
    </div>

    <div class="tooltip-container">
      <img th:src="@{'/maestria/maestria' + ${campeao.maestria} + '.jfif'}"
           class="maestria" alt="icone maestria" />
      <img th:src="@{'/icones/' + ${#strings.toLowerCase(campeao.nome)} + '/icone.webp'}"
           alt="Ícone do Campeão"
           class="icone-campeao"
           onerror="
          this.onerror=null;
          this.src=this.src.replace('.webp', '.png');
          this.onerror=function() {
              this.src=this.src.replace('.png', '.jpg');
              this.onerror=function() {
                  this.src=this.src.replace('.jpg', '.jfif');
                  this.onerror=null;
              };
          };
       " />
      <th:block th:with="nome=${#strings.toLowerCase(campeao.nome)}">
        <img th:src="@{'/splashArt/Campeoes/' + ${#strings.toLowerCase(campeao.nome)} + '/q.webp'}"
             class="icone habilidade-icone"
             th:attr="data-campeao=${#strings.toLowerCase(campeao.nome)}, data-habilidade='q'" />

        <img th:src="@{'/splashArt/Campeoes/' + ${#strings.toLowerCase(campeao.nome)} + '/w.webp'}"
             class="icone habilidade-icone"
             th:attr="data-campeao=${#strings.toLowerCase(campeao.nome)}, data-habilidade='w'" />

        <img th:src="@{'/splashArt/Campeoes/' + ${#strings.toLowerCase(campeao.nome)} + '/e.webp'}"
             class="icone habilidade-icone"
             th:attr="data-campeao=${#strings.toLowerCase(campeao.nome)}, data-habilidade='e'" />

        <img th:src="@{'/splashArt/Campeoes/' + ${#strings.toLowerCase(campeao.nome)} + '/r.webp'}"
             class="icone habilidade-icone"
             th:attr="data-campeao=${#strings.toLowerCase(campeao.nome)}, data-habilidade='r'" />

        <img th:src="@{'/splashArt/Campeoes/' + ${#strings.toLowerCase(campeao.nome)} + '/passive.webp'}"
             class="icone habilidade-icone"
             th:attr="data-campeao=${#strings.toLowerCase(campeao.nome)}, data-habilidade='passive'" />

      </th:block>

      <div class="tooltip-video">
        <iframe width="380" height="215"
                th:src="'https://www.youtube.com/embed/' + ${campeao.videoId}"
                frameborder="0"
                title="YouTube video player"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen>
        </iframe>
      </div>
    </div>
    <a th:href="@{'/campeoes/editar/' + ${campeao.id}}">
      <button type="button" class="botao-editar">Editar</button>
    </a>
  </div>
</div>

<script>
  document.querySelectorAll('.habilidade-icone').forEach(img => {
    img.addEventListener('mouseenter', async () => {
      const campeao = img.dataset.campeao;
      const habilidade = img.dataset.habilidade.toUpperCase();
      const url = `/splashArt/Campeoes/${campeao}/${habilidade}tooltip.txt`;

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('Arquivo não encontrado');
        const text = await response.text();
        const linhas = text.split('\n');
        const descricao = linhas[2] || 'Sem descrição';

        img.title = descricao.replace(/"/g, '');
      } catch (e) {
        img.title = 'Descrição não encontrada';
      }
      const maestria = campeao.maestria;
      document.getElementById("icone-maestria").src = `/maestria/maestria${maestria}.jfif`;
    });
document.querySelectorAll('.tooltip-container').forEach(container => {
  const icon = container.querySelector('.icone-video');
  const tooltip = container.querySelector('.tooltip-video');
  const videoId = container.getAttribute('data-videoid');

  function abrirTooltip() {
    tooltip.innerHTML = `<iframe width="320" height="180" src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
    tooltip.style.display = 'inline-block';
  }

  function fecharTooltip() {
    tooltip.style.display = 'none';
    tooltip.innerHTML = ''; // limpa o iframe para parar o vídeo
  }

  icon.addEventListener('mouseenter', abrirTooltip);

  document.addEventListener('click', (e) => {
    if (!container.contains(e.target)) {
      fecharTooltip());
    }
  });
});

</script>

</body>
</html>
